<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUI LABS - Police Dispatch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="libs/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-container" style="display: none;">
        <main class="dispatch-wrapper">
            
            <aside class="sidebar">
                <div class="brand">NUI <span class="accent">POLICE V0.50 BETA</span></div>
                <nav class="menu-sections custom-scrollbar">
                    <div class="nav-group">
                        <div class="category">Leitstelle</div>
                        <ul>
                            <li class="nav-item active" data-page="map-page"><i class="fas fa-map-marked-alt"></i> Karte</li>
                            <li class="nav-item" data-page="units-page"><i class="fas fa-users"></i> Streifen</li>
                            <li class="nav-item" data-page="person-notes-page"><i class="fas fa-sticky-note"></i> Personen-Notizen</li>
                        </ul>
                    </div>

                    <div class="nav-group">
                        <div class="category">Verzeichnisse</div>
                        <ul>
                            <li class="nav-item" data-page="person-page"><i class="fas fa-person"></i> Personen-Register</li>
                            <li class="nav-item" data-page="vehicle-page"><i class="fas fa-car"></i> KFZ-Register</li>
                            <li class="nav-item" data-page="jail-page"><i class="fas fa-clock"></i> Haftzeiten</li>
                            <li class="nav-item" data-page="warrants-page"><i class="fas fa-file-invoice"></i> Haftbefehle</li>
                        </ul>
                    </div>

                    <div class="nav-group">
                        <div class="category">Archiv</div>
                        <ul>
                            <li class="nav-item" data-page="incidents-page"><i class="fas fa-folder-open"></i> Fallakten</li>
                        </ul>
                    </div>

                    <div class="nav-group">
                        <div class="category">Verordnungen</div>
                        <ul>
                            <li class="nav-item" data-page="penal-page"><i class="fas fa-gavel"></i> Straftatenkatalog</li>
                            <li class="nav-item" data-page="orders-page"><i class="fas fa-file-contract"></i> Dienstanweisung</li>
                        </ul>
                    </div>

                    <div class="nav-group">
                        <div class="category">Verwaltung</div>
                        <ul>
                            <li class="nav-item" data-page="officers-page"><i class="fas fa-user-shield"></i> Beamte</li>
                            <li class="nav-item" data-page="training-page"><i class="fas fa-graduation-cap"></i> Ausbildungen</li>
                        </ul>
                    </div>

                    <div class="nav-group bottom">
                        <ul>
                            <li class="nav-item" data-page="settings-page"><i class="fas fa-cog"></i> Einstellungen</li>
                        </ul>
                    </div>
                </nav>
            </aside>

            <section class="main-content">
                
                <div id="map-page" class="page-content active">
                    <div id="map"></div> 
                    <div class="map-overlay-top">E-Karte</div>
                </div>
                
                <div id="orders-page" class="page-content">
                    <div class="page-header">
                        <div>
                            <h2>Dienstanweisungen</h2>
                            <p>Interne Protokolle und aktuelle Sicherheitslage.</p>
                        </div>
                        <button id="add-directive-btn" class="btn-primary btn-hire-premium" style="display:none;" onclick="openDirectiveModal()">
                            <i class="fas fa-feather-alt"></i> Neue Anweisung
                        </button>
                    </div>

                    <div class="directive-widget hazard-widget">
                        <div class="widget-title">Aktuelle Gefahrenstufe</div>
                        <div id="hazard-selector" class="hazard-container"></div>
                        <div id="hazard-description" class="hazard-info-text">Wähle eine Stufe aus...</div>
                    </div>

                    <div id="directives-list" class="directives-container custom-scrollbar" style="margin-top: 2rem;">
                        </div>
                </div>

                <div id="confirm-modal" class="modal-overlay" style="display: none; z-index: 5000;">
                    <div class="modal-content confirm-box">
                        <div class="confirm-icon"><i class="fas fa-trash-alt"></i></div>
                        <h3>Eintrag löschen?</h3>
                        <p id="confirm-message">Möchten Sie diese Dienstanweisung wirklich unwiderruflich entfernen?</p>
                        <div class="confirm-actions">
                            <button id="confirm-yes" class="btn-confirm danger">Ja, Löschen</button>
                            <button id="confirm-no" class="btn-confirm cancel" onclick="closeConfirm()">Abbrechen</button>
                        </div>
                    </div>
                </div>

                

                <div id="units-page" class="page-content">
                    <div class="page-header">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div>
                                <h2>Streifenverwaltung</h2>
                                <p>Aktive Einheiten koordinieren und Beamte zuweisen.</p>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn-primary btn-hire-premium btn-add-unit" onclick="createNewUnit()">
                                    <i class="fas fa-plus"></i> Neue Streife
                                </button>
                            </div>
                        </div>
                    </div>

                    <div id="units-container" class="units-grid custom-scrollbar">
                        </div>

                    <div class="unassigned-pool-wrapper">
                        <div class="pool-header">Verfügbare Beamte (On Duty)</div>
                        <div id="unassigned-officers" class="officer-pool" ondrop="drop(event)" ondragover="allowDrop(event)">
                            </div>
                    </div>
                </div>


                <div id="person-page" class="page-content person-page-landing">
                    <div id="terminal-access-screen" class="terminal-overlay hidden">
                        <div class="terminal-wrapper">
                            <div class="terminal-header">LSPD CENTRAL NETWORK - AUTHENTICATION</div>
                            <div id="terminal-content" class="terminal-body"></div>
                            <div class="terminal-cursor">_</div>
                        </div>
                    </div>

                    <canvas id="matrix-canvas" class="hidden"></canvas>
                    <div class="background-vignette"></div>

                    <div class="page-header" id="person-header-static">
                        <div class="header-icon-container">
                            <i class="fas fa-fingerprint header-icon-animated"></i>
                        </div>
                        <div>
                            <h2>GOVERNMENT CIVILIAN REGISTRY</h2>
                            <p>State Security Administration - Central Data Hub</p>
                        </div>
                    </div>

                    <div id="registry-landing-hub">
                        <div id="person-result-count" class="result-count-badge hidden"></div>
                        <div id="search-status-display" class="status-box-premium hidden"></div>
                        <div class="security-meta-top">
                            <span>CONNECTION: ENCRYPTED // AES-256 ACTIVE</span>
                        </div>

                        <div class="glitch-title">DATABASE ACCESS</div>
                        <div class="sub-focal">READY FOR SUBJECT PARAMETERS</div>

                        <div class="search-input-wrapper-premium">
                            <input type="text" id="person-search-input" placeholder="PERSON EINGEBEN..." spellcheck="false">
                        </div>

                        <div class="peripheral-data">
                            <div class="data-node">SYS: STABLE</div>
                            <div class="data-node">UPLINK: ACTIVE</div>
                            <div class="data-node">LOC: LOS SANTOS</div>
                        </div>
                        
                        <div id="search-status-display" class="status-box-premium hidden"></div>
                    </div>

                    <div id="search-animation" class="search-overlay-fullscreen hidden">
                        <div class="scan-visual-container">
                            <i class="fas fa-fingerprint fingerprint-huge"></i>
                            <div class="loading-bar-premium">
                                <div id="scan-progress" class="progress-fill"></div>
                            </div>
                            <p id="scanning-message-text" class="scanning-text-premium"></p>
                        </div>
                    </div>

                    <div id="person-results" class="results-grid custom-scrollbar"></div>
                </div>

                <div id="officers-page" class="page-content">
                    <div class="page-header">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div>
                                <h2>Personalverwaltung</h2>
                                <p>Übersicht aller Beamten und deren Dienststatus.</p>
                            </div>
                            <div class="officer-stat-tag">
                                <i class="fas fa-users"></i> <span id="officer-count">0 / 0 Aktiv</span>
                            </div>
                            <button class="btn-primary btn-hire-premium" onclick="openHireModal()">
                                <i class="fas fa-user-plus"></i> Beamten einstellen
                            </button>
                        </div>
                    </div>

                    <div class="officer-table-legend">
                        <div class="leg-col leg-name">Name</div>
                        <div class="leg-col leg-status">Status</div>
                        <div class="leg-col leg-call">Callsign</div>
                        <div class="leg-col leg-actions">Aktionen</div>
                    </div>

                    <div id="officer-list" class="officer-grid custom-scrollbar">
                        </div>
                </div>

                <div id="person-notes-page" class="page-content">
                    <div class="page-header"><h2>Personen-Notizen</h2><p>Zentrale Datenbank für Akteneinträge.</p></div>
                </div>
                <div id="vehicle-page" class="page-content">
                    <div id="vehicle-terminal-screen" class="terminal-overlay hidden">
                        <div class="terminal-wrapper">
                            <div class="terminal-header">LSPD DMV ACCESS - ENCRYPTED UPLINK</div>
                            <div id="vehicle-terminal-content" class="terminal-body"></div>
                            <div class="terminal-cursor">_</div>
                        </div>
                    </div>

                    <div class="page-header" id="vehicle-header-static">
                        <div class="header-icon-container">
                            <i class="fas fa-car-side header-icon-animated"></i>
                        </div>
                        <div>
                            <h2>DEPARTMENT OF MOTOR VEHICLES</h2>
                            <p>National Vehicle Identification & Registration Database</p>
                        </div>
                    </div>

                    <div id="vehicle-landing-hub">
                        <div class="glitch-title">VEHICLE SEARCH</div>
                        <div class="sub-focal">PLATE OR OWNER IDENTIFICATION REQUIRED</div>

                        <div class="search-input-wrapper-premium">
                            <input type="text" id="vehicle-search-input" placeholder="KENNZEICHEN ODER NAME..." spellcheck="false">
                        </div>

                        <div class="peripheral-data">
                            <div class="data-node">DB: DMV_LIVE_01</div>
                            <div class="data-node">STATUS: SECURE</div>
                            <div class="data-node">REGION: SAN ANDREAS</div>
                        </div>
                        
                        <div id="vehicle-search-status" class="status-box-premium hidden"></div>
                    </div>

                    <div id="vehicle-search-animation" class="search-overlay-fullscreen hidden">
                        <div class="scan-visual-container">
                            <div class="vehicle-loader-container">
                                <div class="loader-scanner"></div>
                                <i class="fas fa-search-location scanner-icon-main"></i>
                            </div>
                            <p id="vehicle-scanning-text" class="scanning-text-premium">> SCANNING DMV ARCHIVES...</p>
                        </div>
                    </div>

                    <div id="vehicle-results" class="results-grid custom-scrollbar"></div>
                </div>

                <div id="jail-page" class="page-content">
                    <div class="page-header"><h2>Haftzeiten</h2><p>Übersicht inhaftierter Personen.</p></div>
                </div>
                <div id="warrants-page" class="page-content">
                    <div class="page-header"><h2>Haftbefehle</h2><p>Liste zur Festnahme ausgeschriebener Personen.</p></div>
                </div>
                <div id="incidents-page" class="page-content">
                    <div class="page-header"><h2>Fallakten-Archiv</h2><p>Dokumentation von Straftaten.</p></div>
                </div>
                
                <div id="training-page" class="page-content">
                    <div class="page-header"><h2>Ausbildungs-Status</h2><p>Zertifizierungen für Sondereinheiten.</p></div>
                </div>
                <div id="settings-page" class="page-content">
                    <div class="page-header"><h2>System-Einstellungen</h2><p>Konfiguration der Benutzeroberfläche.</p></div>
                </div>

            </section>

            <aside class="info-panel">
                <div class="panel-segment">
                    <div class="segment-header">
                        <h3>Aktuelle Leitstellen <button class="btn-small">Austragen</button></h3>
                    </div>
                    <div id="active-dispatchers" class="list-container"></div>
                </div>
                <div class="panel-segment">
                    <div class="segment-header">
                        <h3>Dispatches <span class="badge">Alle Infos</span></h3>
                    </div>
                    <div id="dispatch-list" class="list-container"></div>
                </div>
                <div class="panel-segment">
                    <h3>Streifen</h3>
                    <div id="unit-list" class="list-container custom-scrollbar"></div>
                </div>
            </aside>
        </main>
    </div>

    <div id="officer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Beamten-Daten anpassen</h3>
                <i class="fas fa-times close-modal" id="close-officer-modal"></i>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Vollständiger Name</label>
                    <input type="text" id="edit-name" disabled>
                </div>
                <div class="input-group">
                    <label>Dienstnummer (Callsign)</label>
                    <input type="text" id="edit-callsign" placeholder="z.B. 10-42">
                </div>
                <div class="input-group">
                    <label>Dienstgrad / Rang</label>
                    <select id="edit-rank">
                        <option value="1">Rank 1</option>
                        <option value="2">Rank 2</option>
                        <option value="3">Rank 3</option>
                        <option value="4">Rank 4</option>
                        <option value="5">Rank 5</option>
                        <option value="6">Rank 6</option>
                        <option value="7">Rank 7</option>
                        <option value="8">Rank 8</option>
                        <option value="9">Rank 9</option>
                        <option value="10">Rank 10</option>
                        <option value="11">Rank 11</option>
                        <option value="12">Rank 12</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button id="save-officer" class="btn-primary">Änderungen speichern</button>
                </div>
            </div>
        </div>
    </div>

    <div id="hire-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Personen im Umkreis</h3>
                <i class="fas fa-times close-modal" onclick="closeHireModal()"></i>
            </div>
            <div id="nearby-players-list" class="custom-scrollbar" style="max-height: 25rem; overflow-y: auto; padding: 1rem;">
                </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal-overlay" style="display: none; z-index: 3000;">
        <div class="modal-content" style="width: 25rem; text-align: center;">
            <div class="modal-header" style="justify-content: center;">
                <i class="fas fa-exclamation-triangle" style="color: #ff4d4d; font-size: 2.5rem; margin-bottom: 1rem;"></i>
            </div>
            <h3 id="confirm-title" style="color: white; margin-bottom: 1rem;">Sicherheitsabfrage</h3>
            <p id="confirm-message" style="color: var(--text-muted); margin-bottom: 2rem;"></p>
            
            <div style="display: flex; gap: 1rem;">
                <button id="confirm-yes" class="btn-primary" style="background: #ff4d4d; flex: 1;">Bestätigen</button>
                <button id="confirm-no" class="btn-small" style="flex: 1; padding: 1rem;">Abbrechen</button>
            </div>
        </div>
    </div>

    <div id="unit-create-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-unit-title">Streife konfigurieren</h3>
                <i class="fas fa-times close-modal" onclick="closeUnitModal()"></i>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Rufname (z.B. ADAM-1)</label>
                    <input type="text" id="new-unit-name" placeholder="Name eingeben...">
                </div>
                <div class="input-group">
                    <label>Kategorie</label>
                    <select id="new-unit-category">
                        <option value="Airship">Airship (Heli)</option>
                        <option value="SWAT">SWAT / Sondereinheit</option>
                        <option value="Streife">Reguläre Streife</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Status-Code</label>
                    <select id="new-unit-code">
                        <option value="Code 1">Code 1</option>
                        <option value="Code 2">Code 2</option>
                        <option value="Code 3">Code 3</option>
                        <option value="Code 4">Code 4</option>
                        <option value="Code 5">Code 5</option>
                        <option value="Code 6">Code 6</option>
                        <option value="Code 7">Code 7</option>
                        <option value="Code 8">Code 8</option>
                        <option value="Code 9">Code 9</option>
                        <option value="Code 10">Code 10</option>
                    </select>
                </div>
                <button id="unit-modal-submit" class="btn-primary btn-hire-premium" onclick="submitNewUnit()">Erstellen</button>
            </div>
        </div>
    </div>

    <div id="directive-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 40rem;">
            <div class="modal-header">
                <h3>Neue Dienstanweisung</h3>
                <i class="fas fa-times close-modal" onclick="closeDirectiveModal()"></i>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Titel der Anweisung</label>
                    <input type="text" id="dir-title" placeholder="Betreff..." oninput="autoSaveDraft()">
                </div>
                
                <label style="display: block; color: var(--text-muted); margin-bottom: 0.5rem;">Inhalt</label>
                <div class="editor-toolbar">
                    <button class="editor-btn" onclick="formatDoc('bold')" title="Fett"><i class="fas fa-bold"></i></button>
                    <button class="editor-btn" onclick="formatDoc('italic')" title="Kursiv"><i class="fas fa-italic"></i></button>
                    <button class="editor-btn" onclick="formatDoc('underline')" title="Unterstrichen"><i class="fas fa-underline"></i></button>
                    <button class="editor-btn" onclick="formatDoc('insertUnorderedList')" title="Liste"><i class="fas fa-list-ul"></i></button>
                    <button class="editor-btn" onclick="formatDoc('removeFormat')" title="Formatierung löschen"><i class="fas fa-eraser"></i></button>
                </div>
                <div id="dir-editor" contenteditable="true" oninput="autoSaveDraft()"></div>

                <button class="btn-primary btn-hire-premium" id="directive-submit-btn" style="width:100%; margin-top: 1.5rem;" onclick="submitDirective()">
                    Veröffentlichen
                </button>                 
            </div>
        </div>
    </div>

    <div id="add-officer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 30rem;">
            <div class="modal-header">
                <h3 style="color: white !important;">Beamten hinzufügen</h3>
                <i class="fas fa-times close-modal" onclick="closeAddOfficerModal()"></i>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Verfügbare Beamte auswählen</label>
                    <select id="available-officer-select">
                        </select>
                </div>
                <button id="confirm-add-officer" class="btn-primary btn-hire-premium" style="width: 100%;">Zur Streife hinzufügen</button>
            </div>
        </div>
    </div>

    <div id="vehicle-selection-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 28rem; border-color: #ffcc00;"> <div class="modal-header">
                <h3 style="color: white !important;">Fahrzeug zuweisen</h3>
                <i class="fas fa-times close-modal" onclick="closeVehicleModal()"></i>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label style="color: #ffcc00;">Verfügbare Einsatzfahrzeuge</label>
                    <select id="vehicle-dropdown" class="premium-select">
                        </select>
                </div>
                <button id="confirm-vehicle" class="btn-primary" style="width: 100%; background: #ffcc00; color: black;">
                    Fahrzeug bestätigen
                </button>
            </div>
        </div>
    </div>

    <div id="vehicle-notes-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="width: 45rem; max-height: 80vh; display: flex; flex-direction: column;">
            <div class="modal-header">
                <h3>Fahrzeugnotizen: <span id="notes-plate-display" style="color: var(--accent);"></span></h3>
                <i class="fas fa-times close-modal" onclick="closeVehicleNotes()"></i>
            </div>
            <div id="vehicle-notes-list" class="custom-scrollbar" style="flex: 1; overflow-y: auto; margin: 1rem 0; padding-right: 0.5rem;">
                </div>
            <div class="modal-footer" style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1.5rem;">
                <textarea id="new-vehicle-note" placeholder="Neue Information hinzufügen..." class="custom-scrollbar" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 1rem; border-radius: 0.5rem; height: 5rem; resize: none; margin-bottom: 1rem; outline: none;"></textarea>
                <button class="btn-primary btn-hire-premium" style="width: 100%;" onclick="saveVehicleNote()">
                    <i class="fas fa-save"></i> NOTIZ SPEICHERN
                </button>
            </div>
        </div>
    </div>

    <script src="libs/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>